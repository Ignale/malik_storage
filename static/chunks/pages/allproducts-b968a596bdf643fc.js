(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[447],{3670:function(t,e,n){"use strict";var a=n(9499),r=n(3179),i=n(4038),o=n(1039),u=n(5944);e.Z=function(t){var e=t.children;return(0,u.BX)(s,{children:[(0,u.tZ)(i.Z,{}),(0,u.tZ)(d,{children:e})]})};var s=(0,r.Z)("div",{target:"e105wq4n1"})({name:"7whenc",styles:"display:flex;width:100%"}),d=(0,r.Z)("div",{target:"e105wq4n0"})((0,a.Z)({width:"100vw",height:"100vh",overflowY:"scroll",paddingRight:"20px",paddingLeft:"20px"},o.H.tablet,{width:"100vw",paddingBottom:"12vh"}),"")},1366:function(t,e,n){var a,r,i,o,u=n(8588),s=n(6892).gql,d=s(a||(a=u(["\nquery QueryProducts {\n  products(last: 100) {\n    nodes {\n      ... on VariableProduct {\n        id\n        name\n        sku\n        link\n        databaseId\n        productCategories {\n          nodes {\n            name\n            databaseId\n          }\n        }\n        variations {\n          nodes {\n            name\n            databaseId\n            stockQuantity\n            stockStatus\n            sku\n            link\n            metaData {\n              key\n              value\n            }\n            featuredImage {\n              node {\n                sourceUrl(size: MEDIUM)\n              }\n            }\n            price(format: RAW)\n            manageStock\n            id\n            databaseId\n          }\n        }\n        productId\n        link\n      }\n    }\n  }\n}\n"]))),c=s(r||(r=u(["\nquery QueryProductCategories {\n  productCategories(last: 100, first: 0) {\n     nodes {\n      id\n      name\n      databaseId\n    }\n  }\n}\n"]))),l=s(i||(i=u(["\nquery QueryProductCvet {\n   allPaCvet(last: 100, first: 0) {\n    nodes {\n      databaseId\n      id\n      name\n    }\n  }\n}\n"]))),f=s(o||(o=u(["\nquery QueryProductSizes {\n   allPaSize(last: 100, first: 0) {\n    nodes {\n      databaseId\n      id\n      name\n    }\n  }\n}\n"])));t.exports={ALL_SIZES:f,ALL_CVET:l,ALL_PRODUCTS_CATEGORIES:c,ALL_PRODUCTS_QUERY:d}},21:function(t,e,n){"use strict";n.r(e),n.d(e,{default:function(){return z}});var a=n(3670),r=n(1366),i=n(5209),o=n(9499),u=n(6864),s=n(6687),d=n(29),c=n(3179),l=n(7794),f=n.n(l),h=n(5675),y=n.n(h),v=n(4105),p=n(4334),g=n(6094),b=n(4182),m=n(7294),w={src:"/_next/static/media/placeholder-800x800.a28015ef.png",height:800,width:800,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAIBAMAAAA2IaO4AAAALVBMVEX////+/v77+/v6+vr5+fn29vf19fb09PXz9PTz8/Tw8fLq6uzm5+nl5ujV19uwGi/WAAAAJ0lEQVR42mMQEBRkZGBkYBBgEFBLZmQQmN4JJNbdAhLeR2ESgoKMAGAjBQ6UoCggAAAAAElFTkSuQmCC",blurWidth:8,blurHeight:8},Z=n(2896),k=n(8650),I=n(9403),Q=n(2519),A=n(4420),x=n(1039),O=n(5944);function S(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,a)}return n}function C(t,e){return P.apply(this,arguments)}function P(){return(P=(0,d.Z)(f().mark(function t(e,n){var a,r;return f().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return a={method:"POST",body:JSON.stringify(n.arg)},t.prev=2,t.next=5,fetch(e,a);case 5:if(!(r=t.sent).ok){t.next=8;break}return t.abrupt("return",r.json());case 8:t.next=14;break;case 10:throw t.prev=10,t.t0=t.catch(2),console.log(t.t0),t.t0;case 14:case"end":return t.stop()}},t,null,[[2,10]])}))).apply(this,arguments)}function _(t,e){return E.apply(this,arguments)}function E(){return(E=(0,d.Z)(f().mark(function t(e,n){var a,r;return f().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return a={method:"POST",body:JSON.stringify(n.arg)},t.prev=2,t.next=5,fetch(e,a);case 5:if(!(r=t.sent).ok){t.next=8;break}return t.abrupt("return",r.json());case 8:t.next=14;break;case 10:throw t.prev=10,t.t0=t.catch(2),console.log(t.t0),t.t0;case 14:case"end":return t.stop()}},t,null,[[2,10]])}))).apply(this,arguments)}function j(t){var e=t.products,n=t.retData,a=t.defData,r=(0,m.useRef)(null),i=(0,m.useState)(""),d=i[0],c=i[1],l=(0,m.useState)(function(){return(0,s.Z)(e)}),f=l[0],h=l[1],x=(0,m.useState)(function(){return n}),P=x[0],E=x[1],j=(0,m.useState)(function(){return a}),B=j[0],L=j[1],T=(0,m.useState)([]),q=T[0],z=T[1],U=(0,p.Z)("/api/sync",C,{onError:function(t){console.log(t),r.current.show({severity:"error",summary:"Ошибка",detail:t.message,life:3e3})},onSuccess:function(t){JSON.parse(t.ret).success&&t.woo?r.current.show({severity:"success",summary:"Успешно",detail:"Данные синхронизированы",life:3e3}):r.current.show({severity:"error",summary:"Ошибка",detail:"Ошибка синхронизации",life:3e3})},revalidate:!0}).trigger,X=(0,p.Z)("/api/createInCRM",_,{onError:function(t){console.log(t),r.current.show({severity:"error",summary:"Ошибка",detail:t.message,life:3e3})},onSuccess:function(t){console.log(t)},revalidate:!0}).trigger,V=function(t){var e,n=t.newData,a=t.index,r=t.data,i=null==B?void 0:B.find(function(t){return t.databaseId===n.databaseId}),d=null==B?void 0:B.findIndex(function(t){return t.databaseId===n.databaseId});i&&0!==i.defectQuantity?n.stockQuantity!==r.stockQuantity?i.fullQuantity=n.stockQuantity+i.defectQuantity:n.stockQuantity=i.fullQuantity-i.defectQuantity:i&&0===i.defectQuantity&&L(function(t){return(0,s.Z)(t).splice(d,1)});var c=null==P?void 0:null===(e=P.offers.find(function(t){return t.externalId==n.databaseId}))||void 0===e?void 0:e.quantity,l=null==P?void 0:P.offers.find(function(t){return t.externalId==n.databaseId}),y=Object.values(f).findIndex(function(e){return e.variations.nodes.find(function(e){return e.databaseId===t.data.databaseId})});h(function(t){var e=structuredClone(t);return e[y].variations.nodes[a]=n,e}),E(function(t){var e,a=function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?S(Object(n),!0).forEach(function(e){(0,o.Z)(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):S(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}({},(0,u.Z)({},t));return a.offers=null===(e=a.offers)||void 0===e?void 0:e.map(function(t){return t.externalId==n.databaseId&&(t.quantity=n.stockQuantity),t}),a});var v={productId:f[y].productId,variationId:n.databaseId,count:n.stockQuantity,retailId:null==l?void 0:l.id,defectData:B};void 0!==c?U(v):X({product:f[y],variation:n})},M=function(t){return(0,O.tZ)(g.o,{type:"text",value:t.value,style:{width:"100%"},onChange:function(e){var n;return null===(n=t.editorCallback)||void 0===n?void 0:n.call(t,e.target.value)}})},F=function(t){return(0,O.tZ)(b.R,{value:t.value,size:5,onValueChange:function(e){var n;return null===(n=t.editorCallback)||void 0===n?void 0:n.call(t,e.value)}})},H=(0,O.BX)("div",{className:"flex flex-wrap justify-content-end gap-3",children:[(0,O.tZ)(I.z,{label:"Скачать exel",icon:"pi pi-upload",className:"p-button-help",onClick:function(){var t=[];f.forEach(function(e){return e.variations.nodes.forEach(function(e){return t.push({Название:e.name,Количество:e.stockQuantity})})}),console.log(t);var e=v.P6.json_to_sheet(t),n=v.P6.book_new();v.P6.book_append_sheet(n,e,"Sheet1"),v.NC(n,"DataSheet.xlsx")}}),(0,O.BX)(N,{className:"p-input-icon-left",children:[(0,O.tZ)("i",{className:"pi pi-search"}),(0,O.tZ)(g.o,{onChange:function(t){c(t.target.value)},style:{width:"100%"},placeholder:"Поиск"})]}),(0,O.tZ)(D,{icon:"pi pi-plus",onClick:function(){var t={};Object.values(f).forEach(function(e){return t["".concat(e.id)]=!0}),z(t)},label:"Расширить все",text:!0}),(0,O.tZ)(D,{icon:"pi pi-minus",onClick:function(){z([])},label:"Свернуть все",text:!0})]}),Y=function(t){switch(t.stockStatus){case"IN_STOCK":if(0===t.stockQuantity||null===t.stockQuantity)return"danger";if(t.stockQuantity<=3)return"warning";return"success";case"OUT_OF_STOCK":if(0===t.stockQuantity||null===t.stockQuantity)return"danger";if(t.stockQuantity<=3)return"warning";if(t.stockQuantity>=3)return"success";return"danger";default:return null}},J=function(t){return(0,O.tZ)(y(),{style:{objectFit:"cover"},className:"shadow-4",width:50,height:70,src:t.featuredImage?t.featuredImage.node.sourceUrl:w,alt:t.name})},K=function(t){var e,n=t.stockQuantity?t.stockQuantity:0;return(0,O.tZ)(Q.V,{value:n,severity:null===(e=t.stockQuantity)||0===e?"danger":e<4?"warning":"success"})},W=function(t){return(0,O.tZ)(Q.V,{value:t.stockQuantity>0&&t.stockQuantity<=3?"Мало":t.stockQuantity>3?"В наличии":"Нет в наличии",severity:Y(t)})},G=function(t){console.log(B),console.log(t);var e,n=B&&(null===(e=B[B.findIndex(function(e){return e.databaseId===t.databaseId})])||void 0===e?void 0:e.defectQuantity);return console.log(n),null!=n?n:0},$=function(t){return console.log(t),(0,O.tZ)(b.R,{size:1,onChange:function(e){console.log("edit"),L(function(n){var a=n?(0,s.Z)(n):[],r=a.findIndex(function(e){return e.databaseId===t.rowData.databaseId});return -1!==r?(a[r].defectQuantity=e.value,a):(a.push({databaseId:t.rowData.databaseId,fullQuantity:t.rowData.stockQuantity,defectQuantity:e.value}),a)})}})},tt=function(t){var e,n=null==P?void 0:null===(e=P.offers.find(function(e){return e.externalId==t.databaseId}))||void 0===e?void 0:e.quantity;return(0,O.tZ)(Q.V,{severity:n!==t.stockQuantity&&null!==t.stockQuantity?"warning":"info",value:void 0!==n?n:"Нет в системе"})};return(0,O.BX)(O.HY,{children:[(0,O.tZ)(A.F,{ref:r}),(0,O.BX)(R,{value:f,editMode:"row",onRowToggle:function(t){return z(t.data)},expandedRows:q,rowExpansionTemplate:function(t){return(0,O.BX)("div",{className:"p-3",children:[(0,O.BX)("h4",{className:"mb-4",children:["Вариации для ",t.name]}),(0,O.BX)(Z.w,{dataKey:"id",editMode:"row",onRowEditComplete:V,tableStyle:{minWidth:"50rem"},value:t.variations.nodes,children:[(0,O.tZ)(k.s,{style:{width:"10%"},field:"featuredImage",header:"Изображение",body:J}),(0,O.tZ)(k.s,{style:{width:"20%"},field:"name",body:function(t){return t.name+" (id: ".concat(t.databaseId,")")},header:"Название",editor:M,sortable:!0}),(0,O.tZ)(k.s,{style:{width:"15%"},field:"stockStatus",header:"Наличие",sortable:!0,body:W}),(0,O.tZ)(k.s,{style:{width:"15%"},field:"stockQuantity",editor:F,header:"Кол-во в магазине",body:K,sortable:!0}),(0,O.tZ)(k.s,{style:{width:"10%"},field:"price",header:"Цена",sortable:!0}),(0,O.tZ)(k.s,{style:{width:"10%"},header:"Кол-во в CRM",body:tt}),(0,O.tZ)(k.s,{style:{width:"10%"},field:"defect_quantity",header:"Брак",editor:$,body:G}),(0,O.tZ)(k.s,{style:{width:"10%"},rowEditor:!0,headerStyle:{width:"10%",minWidth:"8rem"},bodyStyle:{textAlign:"center"}})]})]})},filterDisplay:"menu",globalFilter:d,globalFilterFields:["name","variations.nodes.name"],dataKey:"id",header:H,children:[(0,O.tZ)(k.s,{expander:!0,style:{width:"3em"}}),(0,O.tZ)(k.s,{field:"name",body:function(t){return(0,O.tZ)(O.HY,{children:(0,O.tZ)("a",{style:{fontWeight:600},href:"".concat(t.link),children:t.name})})},header:"Название"}),(0,O.tZ)(k.s,{body:function(t){return t.variations.nodes.reduce(function(t,e){return t+(null===e.stockQuantity?0:e.stockQuantity)},0)},header:"Количество"})]})]})}var R=(0,c.Z)(Z.w,{target:"eqsjx7z2"})({name:"i2yull",styles:"min-width:20rem"}),D=(0,c.Z)(I.z,{target:"eqsjx7z1"})((0,o.Z)({},x.H.mobileL,{fontSize:"0!important"}),""),N=(0,c.Z)("span",{target:"eqsjx7z0"})((0,o.Z)({},x.H.mobileL,{width:"100%!important"}),""),B=n(4710),L=n(1641),T=n(5591),q=function(t){return fetch(t,{}).then(function(t){return t.json()})},z=function(){var t,e=(0,m.useRef)(null),n=(0,L.a)(r.ALL_PRODUCTS_QUERY,{variables:{first:100}}),o=n.loading,u=n.data,s=(0,T.ZP)("/api/getRetialQuantity",q,{refreshInterval:1e3}),d=s.data,c=s.error,l=(0,T.ZP)("/api/getDefectquantity",q,{refreshInterval:1e3}),f=l.data;return l.error,c&&null!==e.current&&e.current.show({severity:"error",summary:"Ошибка",detail:c.message,life:3e3}),(0,O.BX)(a.Z,{children:[(0,O.tZ)(A.F,{ref:e}),(0,O.tZ)(i.ZP,{container:!0,alignItems:"center",spacing:5,children:(0,O.tZ)(i.ZP,{item:!0,xs:12,children:o?(0,O.tZ)(function(){return(0,O.tZ)(O.HY,{children:Array.from({length:10}).map(function(t,e){return(0,O.tZ)("div",{className:"mb-3 mt-3",children:(0,O.tZ)(B.O,{shape:"rectangle",width:"100%",height:"80px"})},e)})})},{}):(0,O.tZ)(j,{defData:f,retData:d,products:null==u?void 0:null===(t=u.products)||void 0===t?void 0:t.nodes})})})]})}},7063:function(t,e,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/allproducts",function(){return n(21)}])},67:function(){},2061:function(){}},function(t){t.O(0,[257,251,916,567,65,635,898,38,774,888,179],function(){return t(t.s=7063)}),_N_E=t.O()}]);